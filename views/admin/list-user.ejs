<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - User List</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
  <!-- Layout grid: sidebar (1.5fr), konten utama (8fr), sidebar (1.5fr) -->
  <div class="grid grid-cols-[1.5fr_8fr_1.5fr] min-h-screen">
    
    <!-- Sidebar Kiri -->
    <div class="leftsidebar pr-2">
      <%- include('../partials/leftsidebar') %>
    </div>

    <!-- Konten Utama -->
    <main class="content p-10">
      <!-- Header: User / Page -->
      <div class="text-sm text-gray-400 mb-2">
        User / Page <%= currentPage %>
      </div>

      <!-- User Count dan Tombol Tambah User -->
      <div class="flex justify-between items-center mb-6">
        <div class="text-xl font-bold text-gray-800">
          User (<%= totalUsers %> User)
        </div>
        <a href="/admin/users/create" class="bg-gray-800 text-white px-4 py-2 rounded-lg">
          Tambah User
        </a>
      </div>

      <!-- White Box Container (gabungan: search & role, tabel, pagination) -->
      <div class="bg-white p-4 rounded shadow">
        <!-- Div: Search Bar & Role Filter -->
        <div class="flex flex-col sm:flex-row items-start sm:items-end space-y-2 sm:space-y-0 sm:space-x-4 mb-4">
          <!-- Search Bar dengan Icon -->
          <div class="relative">
            <input type="text" name="search" placeholder="Search" 
                   class="w-80 bg-gray-100 pl-10 pr-4 py-2 rounded-lg focus:outline-none text-sm text-gray-500" />
            <div class="absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-4 w-4 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M12.9 14.32a8 8 0 111.414-1.414l4.387 4.387a1 1 0 01-1.414 1.414l-4.387-4.387zM14 8a6 6 0 11-12 0 6 6 0 0112 0z" clip-rule="evenodd"></path>
              </svg>
            </div>
          </div>
          <!-- Custom Dropdown Role Filter -->
          <div class="relative">
            <select name="roleFilter" class="block w-24 bg-gray-100 pl-2 pr-8 py-2 rounded-lg text-sm text-gray-500 focus:outline-none appearance-none">
              <option value="">Roles</option>
              <option value="admin">Admin</option>
              <option value="user">User</option>
            </select>
            <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2">
              <svg class="h-4 w-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>
        </div>

        <!-- Div: Tabel Data User tanpa garis -->
        <div class="mb-4 overflow-x-auto">
          <table class="min-w-full text-gray-800">
            <thead>
              <tr>
                <th class="px-4 py-2 text-left text-sm font-semibold">ID</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Account</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Username</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Role</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Status</th>
                <th class="px-4 py-2 text-left text-sm font-semibold">Tanggal Masuk</th>
                <th class="px-4 py-2"></th>
              </tr>
            </thead>
            <tbody>
              <% users.forEach(user => { %>
                <tr>
                  <td class="px-4 py-2 text-sm"><%= user.id_user %></td>
                  <td class="px-4 py-2">
                    <div class="flex items-center space-x-3">
                      <!-- Foto Profile -->
                      <div class="w-12 h-12">
                        <% if (user.foto) { %>
                          <img src="data:image/jpeg;base64,<%= user.foto.toString('base64') %>" 
                               alt="Profile" 
                               class="w-full h-full rounded-full object-cover" />
                        <% } else { %>
                          <img src="https://via.placeholder.com/80" 
                               alt="Default Profile" 
                               class="w-full h-full rounded-full object-cover" />
                        <% } %>
                      </div>
                      <!-- Full Name & Jabatan -->
                      <div>
                        <div class="font-semibold text-sm">
                          <a href="/admin/users/edit/<%= user.id_user %>" class="text-gray-800">
                            <%= user.fullname %>
                          </a>
                        </div>
                        <div class="text-xs text-gray-500"><%= user.jabatan %></div>
                      </div>
                    </div>
                  </td>
                  <td class="px-4 py-2 text-sm"><%= user.username %></td>
                  <td class="px-4 py-2 text-sm"><%= user.role %></td>
                  <!-- Kolom Status dengan Toggle Switch -->
                  <td class="px-4 py-2">
                    <% if(user.status === 'aktif') { %>
                      <!-- Jika aktif: background hijau, lingkaran di kanan dengan centang -->
                      <div class="relative inline-block w-12 h-6 bg-gray-800 rounded-full">
                        <div class="absolute top-0.5 right-0.5 bg-white w-5 h-5 rounded-full flex items-center justify-center">
                          <svg class="w-3 h-3 text-gray-800" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                          </svg>
                        </div>
                      </div>
                    <% } else { %>
                      <!-- Jika tidak aktif: background merah, lingkaran di kiri dengan X merah -->
                      <div class="relative inline-block w-12 h-6 bg-gray-800 rounded-full">
                        <div class="absolute top-0.5 left-0.5 bg-white w-5 h-5 rounded-full flex items-center justify-center">
                          <svg class="w-3 h-3 text-gray-800" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </div>
                      </div>
                    <% } %>
                  </td>
                  <td class="px-4 py-2 text-sm">
                    <% if(user.tanggal_masuk) { 
                         var t = new Date(user.tanggal_masuk);
                         var dd = ('0' + t.getDate()).slice(-2);
                         var mm = ('0' + (t.getMonth() + 1)).slice(-2);
                         var yyyy = t.getFullYear();
                         var formatted = dd + '-' + mm + '-' + yyyy;
                    %>
                      <%= formatted %>
                    <% } else { %>
                      N/A
                    <% } %>
                  </td>
                  <td class="px-4 py-2 text-center">
                    <form action="/admin/users/delete/<%= user.id_user %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this user?');">
                      <button type="submit" class="text-gray-800 px-2 py-1 rounded-lg hover:bg-red-600">Delete</button>
                    </form>
                  </td>
                </tr>
              <% }); %>
            </tbody>
          </table>
        </div>

        <!-- Div: Pagination (hanya menampilkan < 1 2 >, rata kiri, tombol bulat sempurna) -->
        <div class="flex justify-start items-center space-x-1">
          <a href="?page=<%= currentPage > 1 ? currentPage - 1 : 1 %>" class="flex items-center justify-center w-6 h-6 text-xs text-gray-800 rounded-full">&lt;</a>
          <a href="?page=1" class="flex items-center justify-center w-6 h-6 rounded-full <%= currentPage == 1 ? 'bg-gray-800 text-white' : 'bg-white text-gray-800' %>">1</a>
          <a href="?page=2" class="flex items-center justify-center w-6 h-6 rounded-full <%= currentPage == 2 ? 'bg-gray-800 text-white' : 'bg-white text-gray-800' %>">2</a>
          <a href="?page=<%= currentPage < totalPages ? currentPage + 1 : totalPages %>" class="flex items-center justify-center w-6 h-6 text-xs text-gray-800 rounded-full">&gt;</a>
        </div>
        
      </div>
    </main>

    <!-- Sidebar Kanan -->
    <div class="rightsidebar pl-2">
      <%- include('../partials/rightsidebar') %>
    </div>
  </div>
</body>
</html>
